# Test Bare-metal/OS Development Features
# This tests the freestanding mode features for OS kernel development

print("=== Bare-metal Features Test ===")

# Test MMIO operations (simulated in interpreter)
print("\n1. Memory-Mapped I/O:")
addr = 0x1000  # Simulated MMIO address

# These are no-ops in interpreter mode, but will work in compiled mode
result = mmio_read8(addr)
print(f"   mmio_read8(0x{addr:x}) = {result}")

result = mmio_read16(addr)
print(f"   mmio_read16(0x{addr:x}) = {result}")

result = mmio_read32(addr)
print(f"   mmio_read32(0x{addr:x}) = {result}")

result = mmio_read64(addr)
print(f"   mmio_read64(0x{addr:x}) = {result}")

# Test interrupt control (no-ops in interpreter)
print("\n2. Interrupt Control:")
disable_interrupts()
print("   disable_interrupts() - OK")
enable_interrupts()
print("   enable_interrupts() - OK")

# Test CPU control registers (return 0 in interpreter)
print("\n3. CPU Control Registers (x86):")
cr0 = read_cr0()
print(f"   read_cr0() = {cr0}")
cr3 = read_cr3()
print(f"   read_cr3() = {cr3}")

# Test MSR operations
print("\n4. Model-Specific Registers:")
msr_value = read_msr(0x1B)  # IA32_APIC_BASE
print(f"   read_msr(0x1B) = {msr_value}")

# Test port I/O (no-ops in interpreter)
print("\n5. Port I/O (x86):")
port = 0x3F8  # COM1
result = port_in(port)
print(f"   port_in(0x{port:x}) = {result}")

result = port_in16(port)
print(f"   port_in16(0x{port:x}) = {result}")

result = port_in32(port)
print(f"   port_in32(0x{port:x}) = {result}")

# Test halt (no-op in interpreter)
print("\n6. CPU Halt:")
# halt()  # Would halt in bare-metal mode
print("   halt() - skipped (would halt CPU)")

# Test inline assembly (no-op in interpreter)
print("\n7. Inline Assembly:")
asm("nop")
print("   asm('nop') - OK")

print("\n=== All Bare-metal Tests Passed ===")
