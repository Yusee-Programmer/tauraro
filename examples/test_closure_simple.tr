# Simple closure backend test with manual button click
from webviewtk import Window, register_command, mount_and_run, CustomTitleBar

# Backend handler
def add(args):
    a = args.get("a", 0)
    b = args.get("b", 0)
    result = a + b
    print(f"‚úÖ Backend executed: {a} + {b} = {result}")
    return {"result": result}

# Create window
window = Window(
    title="Tauraro Backend Test",
    width=500,
    height=350,
    native_titlebar=False
)

# Register command
register_command(window, "add", add)

# HTML with custom titlebar
window._custom_html = """
<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .titlebar {
            -webkit-app-region: drag;
            background: rgba(0, 0, 0, 0.3);
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .titlebar-title { font-size: 13px; margin-left: 8px; }
        .titlebar-buttons {
            -webkit-app-region: no-drag;
            display: flex;
            gap: 5px;
        }
        .titlebar-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
        }
        .titlebar-btn:hover { background: rgba(255, 255, 255, 0.2); }
        .titlebar-btn.close:hover { background: #e81123; }
        .content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
        }
        h2 { margin-bottom: 15px; font-size: 22px; }
        input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: none;
            border-radius: 5px;
            font-size: 15px;
        }
        button.calc {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            background: white;
            color: #667eea;
        }
        button.calc:hover { transform: scale(1.02); }
        #result {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="titlebar">
        <span class="titlebar-title">üßÆ Tauraro Backend Test</span>
        <div class="titlebar-buttons">
            <button class="titlebar-btn minimize" onclick="window.ipc.postMessage('window:minimize')">‚àí</button>
            <button class="titlebar-btn maximize" onclick="window.ipc.postMessage('window:maximize')">‚ñ°</button>
            <button class="titlebar-btn close" onclick="window.ipc.postMessage('window:close')">√ó</button>
        </div>
    </div>
    
    <div class="content">
        <div class="box">
            <h2>Test Tauraro Backend</h2>
            <p style="font-size: 14px; margin-bottom: 15px;">Click button to call Tauraro function</p>
            
            <input type="number" id="a" placeholder="Number A" value="5">
            <input type="number" id="b" placeholder="Number B" value="3">
            
            <button class="calc" onclick="callBackend()">Calculate</button>
            
            <div id="result"></div>
        </div>
    </div>

    <script>
        console.log('‚úÖ Page loaded');
        
        async function callBackend() {
            const a = parseInt(document.getElementById('a').value) || 0;
            const b = parseInt(document.getElementById('b').value) || 0;
            const resultDiv = document.getElementById('result');
            
            resultDiv.style.display = 'block';
            resultDiv.textContent = '‚è≥ Calling backend...';
            
            try {
                console.log(`üîµ Calling add(${a}, ${b})`);
                const result = await window.invoke('add', { a, b });
                console.log('‚úÖ Result:', result);
                resultDiv.textContent = `‚úÖ Result: ${a} + ${b} = ${result.result}`;
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.textContent = `‚ùå Error: ${error}`;
            }
        }
    </script>
</body>
</html>
"""

# Run
ui = CustomTitleBar()
mount_and_run(window, ui)
