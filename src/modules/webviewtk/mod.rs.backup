/// WebViewTK - Cross-platform GUI framework for Tauraro
/// Uses HTML, CSS, and JavaScript for UI rendering with Tauraro handling the logic
/// Similar to Tauri and Electron.js

use crate::value::Value;
use anyhow::Result;
use std::collections::HashMap;
use std::rc::Rc;
use std::cell::RefCell;

// Submodules
mod utils;
mod widgets;
mod resources;
mod drag;
mod menu;
mod titlebar;
mod window;

// Re-export utility functions
pub use utils::{build_element, escape_html, extract_string_arg, extract_dict_arg, render_html, escape_html_func};

// Re-export widget functions
pub use widgets::*;

// Re-export resource functions
pub use resources::*;

// Re-export drag/titlebar control functions
pub use drag::{
    create_draggable_titlebar, inject_drag_css, inject_drag_js,
    inject_window_control_api, get_drag_region_css, get_drag_region_js,
    get_window_control_api_js
};

// Re-export menu, titlebar, and window functions
pub use menu::{create_menu, create_menu_item, create_menu_separator, menu_add_item};
pub use titlebar::create_titlebar;
pub use window::{
    create_window_class, window_set_html, window_set_menu, window_set_titlebar,
    window_set_icon, window_set_resizable, window_disable_decorations,
    window_run, window_run_async
};

/// Create the webviewtk module object with all its functions and classes
pub fn create_webviewtk_module() -> Value {
    let mut namespace = HashMap::new();

    // Widget creation functions
    namespace.insert("div".to_string(), Value::NativeFunction(widgets::create_div));
    namespace.insert("button".to_string(), Value::NativeFunction(widgets::create_button));
    namespace.insert("paragraph".to_string(), Value::NativeFunction(widgets::create_paragraph));
    namespace.insert("p".to_string(), Value::NativeFunction(widgets::create_paragraph)); // Alias
    namespace.insert("heading".to_string(), Value::NativeFunction(widgets::create_heading));
    namespace.insert("h1".to_string(), Value::NativeFunction(widgets::create_h1));
    namespace.insert("h2".to_string(), Value::NativeFunction(widgets::create_h2));
    namespace.insert("h3".to_string(), Value::NativeFunction(widgets::create_h3));
    namespace.insert("h4".to_string(), Value::NativeFunction(widgets::create_h4));
    namespace.insert("h5".to_string(), Value::NativeFunction(widgets::create_h5));
    namespace.insert("h6".to_string(), Value::NativeFunction(widgets::create_h6));
    namespace.insert("span".to_string(), Value::NativeFunction(widgets::create_span));
    namespace.insert("input".to_string(), Value::NativeFunction(widgets::create_input));
    namespace.insert("textarea".to_string(), Value::NativeFunction(widgets::create_textarea));
    namespace.insert("label".to_string(), Value::NativeFunction(widgets::create_label));
    namespace.insert("form".to_string(), Value::NativeFunction(widgets::create_form));
    namespace.insert("img".to_string(), Value::NativeFunction(widgets::create_img));
    namespace.insert("link".to_string(), Value::NativeFunction(widgets::create_link));
    namespace.insert("a".to_string(), Value::NativeFunction(widgets::create_link)); // Alias
    namespace.insert("ul".to_string(), Value::NativeFunction(widgets::create_ul));
    namespace.insert("ol".to_string(), Value::NativeFunction(widgets::create_ol));
    namespace.insert("li".to_string(), Value::NativeFunction(widgets::create_li));
    namespace.insert("table".to_string(), Value::NativeFunction(widgets::create_table));
    namespace.insert("tr".to_string(), Value::NativeFunction(widgets::create_tr));
    namespace.insert("td".to_string(), Value::NativeFunction(widgets::create_td));
    namespace.insert("th".to_string(), Value::NativeFunction(widgets::create_th));
    namespace.insert("nav".to_string(), Value::NativeFunction(widgets::create_nav));
    namespace.insert("header".to_string(), Value::NativeFunction(widgets::create_header));
    namespace.insert("footer".to_string(), Value::NativeFunction(widgets::create_footer));
    namespace.insert("section".to_string(), Value::NativeFunction(widgets::create_section));
    namespace.insert("article".to_string(), Value::NativeFunction(widgets::create_article));
    namespace.insert("aside".to_string(), Value::NativeFunction(widgets::create_aside));
    namespace.insert("main".to_string(), Value::NativeFunction(widgets::create_main));
    namespace.insert("select".to_string(), Value::NativeFunction(widgets::create_select));
    namespace.insert("option".to_string(), Value::NativeFunction(widgets::create_option));
    namespace.insert("checkbox".to_string(), Value::NativeFunction(widgets::create_checkbox));
    namespace.insert("radio".to_string(), Value::NativeFunction(widgets::create_radio));

    // HTML structure functions
    namespace.insert("html".to_string(), Value::NativeFunction(widgets::create_html));
    namespace.insert("head".to_string(), Value::NativeFunction(widgets::create_head));
    namespace.insert("body".to_string(), Value::NativeFunction(widgets::create_body));
    namespace.insert("title".to_string(), Value::NativeFunction(widgets::create_title));
    namespace.insert("meta".to_string(), Value::NativeFunction(widgets::create_meta));
    namespace.insert("style".to_string(), Value::NativeFunction(widgets::create_style));
    namespace.insert("script".to_string(), Value::NativeFunction(widgets::create_script));

    // CDN and external resource functions
    namespace.insert("cdn_tailwind".to_string(), Value::NativeFunction(resources::cdn_tailwind));
    namespace.insert("cdn_bootstrap".to_string(), Value::NativeFunction(resources::cdn_bootstrap));
    namespace.insert("cdn_jquery".to_string(), Value::NativeFunction(resources::cdn_jquery));
    namespace.insert("cdn_vue".to_string(), Value::NativeFunction(resources::cdn_vue));
    namespace.insert("cdn_react".to_string(), Value::NativeFunction(resources::cdn_react));
    namespace.insert("cdn_alpine".to_string(), Value::NativeFunction(resources::cdn_alpine));
    namespace.insert("cdn_custom".to_string(), Value::NativeFunction(resources::cdn_custom));
    namespace.insert("style_link".to_string(), Value::NativeFunction(resources::style_link));
    namespace.insert("script_link".to_string(), Value::NativeFunction(resources::script_link));

    // Draggable titlebar and window control functions
    namespace.insert("draggable_titlebar".to_string(), Value::NativeFunction(drag::create_draggable_titlebar));
    namespace.insert("inject_drag_css".to_string(), Value::NativeFunction(drag::inject_drag_css));
    namespace.insert("inject_drag_js".to_string(), Value::NativeFunction(drag::inject_drag_js));
    namespace.insert("inject_window_api".to_string(), Value::NativeFunction(drag::inject_window_control_api));

    // Menu and title bar functions
    namespace.insert("menu".to_string(), Value::NativeFunction(menu::create_menu));
    namespace.insert("menu_item".to_string(), Value::NativeFunction(menu::create_menu_item));
    namespace.insert("menu_separator".to_string(), Value::NativeFunction(menu::create_menu_separator));
    namespace.insert("menu_add_item".to_string(), Value::NativeFunction(menu::menu_add_item));
    namespace.insert("titlebar".to_string(), Value::NativeFunction(titlebar::create_titlebar));

    // Window class
    namespace.insert("Window".to_string(), Value::NativeFunction(window::create_window_class));

    // Utility functions
    namespace.insert("render".to_string(), Value::NativeFunction(utils::render_html));
    namespace.insert("escape_html".to_string(), Value::NativeFunction(utils::escape_html_func));


