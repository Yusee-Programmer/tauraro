# Clean Win32 API FFI Test in Tauraro
# Demonstrates native library loading and function calls

# Load Windows API libraries
user32 = load_library("user32.dll")
kernel32 = load_library("kernel32.dll")

# Define Win32 API functions
MessageBoxA = define_function("user32.dll", "MessageBoxA", "int",
    ["pointer", "string", "string", "int"])
GetModuleHandleA = define_function("kernel32.dll", "GetModuleHandleA", "pointer",
    ["pointer"])
GetSystemMetrics = define_function("user32.dll", "GetSystemMetrics", "int",
    ["int"])
GetDesktopWindow = define_function("user32.dll", "GetDesktopWindow", "pointer",
    [])

print("========================================")
print("Tauraro Win32 FFI Test")
print("========================================")
print("")

# Test 1: Get module handle
print("Test 1: Getting module handle...")
hInstance = call_function(GetModuleHandleA, 0)
print("Module handle obtained successfully!")
print("")

# Test 2: Get system metrics
print("Test 2: Getting screen dimensions...")
screen_width: int = call_function(GetSystemMetrics, 0)  # SM_CXSCREEN = 0
screen_height: int = call_function(GetSystemMetrics, 1) # SM_CYSCREEN = 1
print("Screen width:")
print(screen_width)
print("Screen height:")
print(screen_height)
print("")

# Test 3: Get desktop window handle
print("Test 3: Getting desktop window handle...")
desktop = call_function(GetDesktopWindow)
print("Desktop window handle obtained!")
print("")

# Test 4: Show message boxes with different styles
print("Test 4: Showing message box...")
result1: int = call_function(MessageBoxA, 0,
    "This is compiled from Tauraro to native C!\n\nThe FFI system works perfectly!",
    "Tauraro Native Compilation Success", 0)

print("First message box result:")
print(result1)
print("")

# Show completion message
print("========================================")
print("All FFI Tests Completed Successfully!")
print("========================================")
print("")
print("Summary:")
print("- Library loading (LoadLibraryA): WORKS")
print("- Function loading (GetProcAddress): WORKS")
print("- Function calls with arguments: WORKS")
print("- Return value handling: WORKS")
print("")
print("The Tauraro script was successfully compiled")
print("to native C code and executed Win32 API calls!")
